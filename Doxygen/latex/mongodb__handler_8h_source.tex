\hypertarget{mongodb__handler_8h_source}{}\doxysection{mongodb\+\_\+handler.\+h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <cstdint>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}vector"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}bsoncxx/json.hpp"{}}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include "{}mongocxx/client.hpp"{}}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}mongocxx/stdx.hpp"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}mongocxx/uri.hpp"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}mongocxx/instance.hpp"{}}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}mongocxx/database.hpp"{}}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}bsoncxx/builder/stream/helpers.hpp"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}bsoncxx/builder/stream/document.hpp"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}bsoncxx/builder/stream/array.hpp"{}}}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 }
\DoxyCodeLine{25 }
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{namespace }Users \{}
\DoxyCodeLine{28     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{char} kMongoDbUri[] = \textcolor{stringliteral}{"{}mongodb://0.0.0.0:27017"{}};}
\DoxyCodeLine{29     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{char} kDatabaseName[] = \textcolor{stringliteral}{"{}TECGallery"{}};}
\DoxyCodeLine{30     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{char} kCollectionName[] = \textcolor{stringliteral}{"{}Users"{}};}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \textcolor{keyword}{class }\mbox{\hyperlink{class_users_1_1_mongo_db_user_handler}{MongoDbUserHandler}} \{}
\DoxyCodeLine{33     \textcolor{keyword}{public}:}
\DoxyCodeLine{34         \mbox{\hyperlink{class_users_1_1_mongo_db_user_handler}{MongoDbUserHandler}}()}
\DoxyCodeLine{35                 : uri(mongocxx::uri(kMongoDbUri)),}
\DoxyCodeLine{36                   client(mongocxx::client(uri)),}
\DoxyCodeLine{37                   db(client[kDatabaseName]) \{\}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39         \textcolor{keywordtype}{bool} AddUserToDb(\textcolor{keyword}{const} std::string \&user\_name,}
\DoxyCodeLine{40                               \textcolor{keyword}{const} std::string \&user\_pass) \{}
\DoxyCodeLine{41             mongocxx::collection collection = db[kCollectionName];}
\DoxyCodeLine{42             \textcolor{keyword}{auto} builder = bsoncxx::builder::stream::document\{\};}
\DoxyCodeLine{43 }
\DoxyCodeLine{44             bsoncxx::v\_noabi::document::value doc\_value =}
\DoxyCodeLine{45                     builder << \textcolor{stringliteral}{"{}User\_name"{}} << user\_name}
\DoxyCodeLine{46                             << \textcolor{stringliteral}{"{}Password"{}} << user\_pass <<bsoncxx::builder::stream::finalize;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48             bsoncxx::stdx::optional<mongocxx::result::insert\_one> maybe\_result =}
\DoxyCodeLine{49                     collection.insert\_one(doc\_value.view());}
\DoxyCodeLine{50 }
\DoxyCodeLine{51             \textcolor{keywordflow}{if}(maybe\_result) \{}
\DoxyCodeLine{52                 \textcolor{keywordflow}{return} maybe\_result-\/>inserted\_id().get\_oid().value.to\_string().size() != 0;}
\DoxyCodeLine{53             \}}
\DoxyCodeLine{54             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{55         \}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57         \textcolor{keywordtype}{bool} RemoveUserFromDb(\textcolor{keyword}{const} std::string \&user\_name) \{}
\DoxyCodeLine{58             mongocxx::collection collection = db[kCollectionName];}
\DoxyCodeLine{59             \textcolor{keyword}{auto} builder = bsoncxx::builder::stream::document\{\};}
\DoxyCodeLine{60 }
\DoxyCodeLine{61             bsoncxx::document::value doc =}
\DoxyCodeLine{62                     builder << \textcolor{stringliteral}{"{}User\_name"{}} << user\_name << bsoncxx::builder::stream::finalize;}
\DoxyCodeLine{63             bsoncxx::stdx::optional<mongocxx::result::delete\_result> maybe\_result =}
\DoxyCodeLine{64                     collection.delete\_one(doc.view());}
\DoxyCodeLine{65 }
\DoxyCodeLine{66             \textcolor{keywordflow}{if}(maybe\_result) \{}
\DoxyCodeLine{67                 \textcolor{keywordflow}{return} maybe\_result-\/>deleted\_count() == 1;}
\DoxyCodeLine{68             \}}
\DoxyCodeLine{69             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{70         \}}
\DoxyCodeLine{71         \textcolor{keywordtype}{bool} getUserPass(\textcolor{keyword}{const} std::string \&user\_name, \textcolor{keyword}{const} std::string \&password)\{}
\DoxyCodeLine{72             mongocxx::collection collection = db[kCollectionName];}
\DoxyCodeLine{73             \textcolor{keyword}{auto} builder=bsoncxx::builder::stream::document\{\};}
\DoxyCodeLine{74 }
\DoxyCodeLine{75             bsoncxx::document::value doc =}
\DoxyCodeLine{76                     builder<<\textcolor{stringliteral}{"{}User\_name"{}}<<user\_name<<bsoncxx::builder::stream::finalize;}
\DoxyCodeLine{77             bsoncxx::stdx::optional<bsoncxx::document::value> maybe\_result = collection.find\_one(doc.view());}
\DoxyCodeLine{78 }
\DoxyCodeLine{79             bsoncxx::document::view view = maybe\_result-\/>view();}
\DoxyCodeLine{80             bsoncxx::document::element element1 = view[\textcolor{stringliteral}{"{}Password"{}}];}
\DoxyCodeLine{81             bsoncxx::document::element element2 = view[\textcolor{stringliteral}{"{}User\_name"{}}];}
\DoxyCodeLine{82 }
\DoxyCodeLine{83             std::string query\_password = element1.get\_utf8().value.to\_string();}
\DoxyCodeLine{84             std::string query\_user\_name = element2.get\_utf8().value.to\_string();}
\DoxyCodeLine{85 }
\DoxyCodeLine{86             \textcolor{keywordflow}{if} (user\_name==query\_user\_name)\{}
\DoxyCodeLine{87 }
\DoxyCodeLine{88                 \textcolor{keywordflow}{if}(password==query\_password)\{}
\DoxyCodeLine{89                  \textcolor{comment}{//std::cout<<"{}True"{}<<std::endl;}}
\DoxyCodeLine{90                     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{91                 \}}
\DoxyCodeLine{92                 \textcolor{comment}{//std::cout<<"{}False"{}<<std::endl;}}
\DoxyCodeLine{93             \} \textcolor{keywordflow}{else}\{}
\DoxyCodeLine{94                 std::cout<<\textcolor{stringliteral}{"{}Wrong user name"{}}<<std::endl;}
\DoxyCodeLine{95             \}}
\DoxyCodeLine{96         \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98         \textcolor{keywordtype}{bool} updatePassword(\textcolor{keyword}{const} std::string \&user\_name, \textcolor{keyword}{const} std::string \&new\_password) \{}
\DoxyCodeLine{99             mongocxx::collection collection = db[kCollectionName];}
\DoxyCodeLine{100             \textcolor{keyword}{auto} builder = bsoncxx::builder::stream::document\{\};}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 }
\DoxyCodeLine{103             bsoncxx::document::value query\_doc =}
\DoxyCodeLine{104                     builder << \textcolor{stringliteral}{"{}User\_name"{}} << user\_name}
\DoxyCodeLine{105                             << bsoncxx::builder::stream::finalize;}
\DoxyCodeLine{106             bsoncxx::document::value update\_doc =}
\DoxyCodeLine{107                     builder << \textcolor{stringliteral}{"{}\$set"{}} << bsoncxx::builder::stream::open\_document << \textcolor{stringliteral}{"{}Password"{}}}
\DoxyCodeLine{108                             << new\_password << bsoncxx::builder::stream::close\_document}
\DoxyCodeLine{109                             << bsoncxx::builder::stream::finalize;}
\DoxyCodeLine{110 }
\DoxyCodeLine{111             bsoncxx::stdx::optional<mongocxx::result::update> maybe\_result =}
\DoxyCodeLine{112                     collection.update\_one(query\_doc.view(), update\_doc.view());}
\DoxyCodeLine{113 }
\DoxyCodeLine{114             \textcolor{keywordflow}{if}(maybe\_result) \{}
\DoxyCodeLine{115                 \textcolor{keywordflow}{return} maybe\_result-\/>modified\_count() == 1;}
\DoxyCodeLine{116             \}}
\DoxyCodeLine{117             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{118         \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{keyword}{private}:}
\DoxyCodeLine{121         mongocxx::uri uri;}
\DoxyCodeLine{122         mongocxx::client client;}
\DoxyCodeLine{123         mongocxx::database db;}
\DoxyCodeLine{124     \};}
\DoxyCodeLine{125 \}}

\end{DoxyCode}
